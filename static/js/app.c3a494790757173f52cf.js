webpackJsonp([1],{111:function(e,t){},112:function(e,t){},113:function(e,t){},114:function(e,t){},117:function(e,t,o){e.exports=o.p+"static/img/chula.1ecbc43.jpg"},118:function(e,t,o){function i(e){o(111)}var n=o(15)(o(68),o(121),i,null,null);e.exports=n.exports},119:function(e,t,o){function i(e){o(114)}var n=o(15)(o(69),o(124),i,null,null);e.exports=n.exports},120:function(e,t,o){function i(e){o(113)}var n=o(15)(o(70),o(123),i,null,null);e.exports=n.exports},121:function(e,t,o){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"center-column"},[i("h1",[e._v("BKKHackmap")]),e._v(" "),i("a",{staticClass:"help-icon"},[e._v("?"),i("div",{staticClass:"help-text",domProps:{innerHTML:e._s(e.helpText)}})]),e._v(" "),e.username?i("a",{staticClass:"account-status",on:{click:e.logout}},[e._v(e._s(e.username)+" (Log out)")]):i("a",{staticClass:"account-status",on:{click:e.login}},[e._v("Log in")]),e._v(" "),i("div",{staticClass:"droptarget",on:{dragover:e.dragover,drop:e.drop}},[i("img",{staticClass:"floorplan",attrs:{src:o(117)}}),e._v(" "),e._l(e.projects,function(t){return t.x?i("img",{key:t.id,staticClass:"marker",class:{selected:e.selectedProject===t},style:{left:e.mapWidth*t.x-20+"px",top:e.mapHeight*t.y-20+"px"},attrs:{width:"36",draggable:t.username===e.username,"data-id":t.id,src:t.avatar_thumbnail,alt:t.username,title:t.title},on:{dragstart:e.drag,click:function(o){e.updateSelectedProject(t)}}}):e._e()})],2)])},staticRenderFns:[]}},122:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"appContainer"}},[o("left",{attrs:{form:e.form,projects:e.projects,selectedProject:e.selectedProject,username:e.username},on:{toggleForm:e.toggleForm,updateSelectedProject:e.updateSelectedProject,drag:e.leftDrag}}),e._v(" "),o("center",{attrs:{projects:e.projects,selectedProject:e.selectedProject,helpText:e.helpText,username:e.username,mapWidth:e.mapWidth,mapHeight:e.mapHeight},on:{updateSelectedProject:e.updateSelectedProject,login:e.login,logout:e.logout,drop:e.centerDrop}}),e._v(" "),o("right",{attrs:{selectedProject:e.selectedProject,username:e.username},on:{toggleEditMode:e.toggleEditMode,updateProject:e.updateProject}})],1)},staticRenderFns:[]}},123:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"details side-column"},[e.selectedProject.id?[e.selectedProject.username===e.username?o("a",{staticClass:"edit-button",on:{click:e.toggleEditMode}},[e._v(e._s(e.selectedProject.editMode?"X":"Edit"))]):e._e(),e._v(" "),o("img",{staticClass:"avatar",attrs:{src:e.selectedProject.avatar,alt:e.selectedProject.username,width:"122"}}),e._v(" "),o("p",[o("a",{attrs:{href:"https://github.com/"+e.selectedProject.username}},[e._v("@"+e._s(e.selectedProject.username))]),e._v(" is hacking on:")]),e._v(" "),e.selectedProject.editMode?[o("input",{directives:[{name:"model",rawName:"v-model",value:e.selectedProject.title,expression:"selectedProject.title"}],attrs:{type:"text",autofocus:""},domProps:{value:e.selectedProject.title},on:{input:function(t){t.target.composing||(e.selectedProject.title=t.target.value)}}}),e._v(" "),o("textarea",{directives:[{name:"model",rawName:"v-model",value:e.selectedProject.description,expression:"selectedProject.description"}],domProps:{value:e.selectedProject.description},on:{input:function(t){t.target.composing||(e.selectedProject.description=t.target.value)}}}),e._v(" "),o("button",{staticClass:"glow-button",on:{click:e.updateProject}},[e._v("Update")])]:[o("h2",[e._v(e._s(e.selectedProject.title))]),e._v(" "),o("p",{staticClass:"selected-project-description"},[e._v(e._s(e.selectedProject.description))])]]:e._e()],2)},staticRenderFns:[]}},124:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"projects side-column"},[o("div",{staticClass:"project-form",class:{open:e.form.isOpen}},[o("input",{directives:[{name:"model",rawName:"v-model",value:e.form.title,expression:"form.title"}],attrs:{type:"text",placeholder:"Topic",autofocus:""},domProps:{value:e.form.title},on:{input:function(t){t.target.composing||(e.form.title=t.target.value)}}}),e._v(" "),o("textarea",{directives:[{name:"model",rawName:"v-model",value:e.form.description,expression:"form.description"}],attrs:{placeholder:"More description (optional)"},domProps:{value:e.form.description},on:{input:function(t){t.target.composing||(e.form.description=t.target.value)}}})]),e._v(" "),o("button",{staticClass:"glow-button",on:{click:e.toggleForm}},[e._v("+ Add your hack")]),e._v(" "),e._l(e.projects,function(t){return o("div",{key:t.id,staticClass:"project",class:{selected:e.selectedProject===t},attrs:{"data-id":t.id,draggable:t.username===e.username},on:{dragstart:e.drag,click:function(o){e.updateSelectedProject(t)}}},[o("img",{attrs:{src:t.avatar_thumbnail,width:"36",alt:t.username,draggable:"false"}}),e._v("\n  "+e._s(t.title)+"\n  ")])}),e._v(" "),0===e.projects.length?o("div",{staticClass:"details"},[e._v("\n    No hacks yet! You can be first!\n  ")]):e._e(),e._v(" "),e.projects.loading?o("div",{staticClass:"loader"},[o("div",{staticClass:"loader1"}),e._v(" "),o("div",{staticClass:"loader2"}),e._v(" "),o("div",{staticClass:"loader3"})]):e._e()],2)},staticRenderFns:[]}},30:function(e,t,o){"use strict";var i=o(72),n=o.n(i),r=o(24),a=o.n(r),s=window.location.href.indexOf("index.html")>=0?window.location.href.replace("index.html","oauth_redirect.html"):window.location.href+"oauth_redirect.html",c="https://github.com/login/oauth/authorize?scope=public_repo&redirect_uri="+s+"&client_id=1b717d04ec7f3615bb18",u="https://bkkhackmap.herokuapp.com/authenticate/";a.a.options(u),t.a={isLoggedIn:function(){return!!window.localStorage.getItem("token")},logOut:function(){window.localStorage.removeItem("token")},getOAuthToken:function(){return new n.a(function(e,t){var o=window.localStorage.getItem("token");if(o)return void e(o);var i=window.open(c);window.addEventListener("oauth-code-received",function(o){var n=o.detail;a.a.get(u+n).then(function(t){window.localStorage.setItem("token",t.data.token),i.close(),e(t.data.token)}).catch(function(e){return t(e)})})})}}},45:function(e,t,o){function i(e){o(112)}var n=o(15)(o(67),o(122),i,null,null);e.exports=n.exports},64:function(e,t,o){"use strict";var i=o(73),n=o.n(i),r=o(74),a=o.n(r),s=o(24),c=o.n(s),u=o(65),d=o(30),l=function(){function e(t){var o=this;n()(this,e),this.config=t,this.github=this.createGithubApiClient(t.organization,t.repository),d.a.isLoggedIn()&&this.ensureAuthenticatedClient(),this.github.repo.get("issues",{params:{labels:this.config.label}}).then(function(e){if(!e.data.length)throw new Error("Could not find an open issue labeled: "+o.config.label);var i=e.data[0];t.onHelpText(i.body),o.issueNumber=i.number}).then(function(){return o.pollIssueForComments()}).catch(function(e){return o.reportError(e)})}return a()(e,[{key:"postNewProject",value:function(e){var t=this;return this.ensureAuthenticatedClient().then(function(){var o=u.a.serializeProjectToComment(e);return t.github.repo.post("issues/"+t.issueNumber+"/comments",{body:o})}).then(function(e){return u.a.deserializeCommentToProject(e.data)})}},{key:"updateProject",value:function(e){var t=this;return this.ensureAuthenticatedClient().then(function(){var o=u.a.serializeProjectToComment(e);return t.github.repo.patch("issues/comments/"+e.id,{body:o})}).then(function(e){return u.a.deserializeCommentToProject(e.data)})}},{key:"pollIssueForComments",value:function(){var e,t=this,o="issues/"+this.issueNumber+"/comments",i=function(){return console.log("polling..."),t.github.repo.get(o,{headers:e?{"If-None-Match":e}:{}}).then(function(o){if(200===o.status){e=o.headers.etag;var i=o.data.map(u.a.deserializeCommentToProject);t.config.onProjectsUpdated(i)}}).catch(function(e){return t.reportError(e)})};return window.setInterval(i,1e3*this.config.pollIntervalSeconds),i()}},{key:"ensureAuthenticatedClient",value:function(){var e=this;return this.config.onAuthenticationRequired().then(function(t){if(!e.github.isAuthenticated)return e.github=e.createGithubApiClient(e.config.organization,e.config.repository,t),e.github.isAuthenticated=!0,e.github.get("user")}).then(function(t){t&&e.config.onUserAuthenticated(t)})}},{key:"deauthenticateClient",value:function(){d.a.logOut(),this.github=this.createGithubApiClient(this.config.organization,this.config.repository)}},{key:"createGithubApiClient",value:function(e,t,o){function i(e){var t={baseURL:"https://api.github.com/"+(e||"")};return o&&(t.headers={Authorization:"token "+o}),t}var n=c.a.create(i());return n.repo=c.a.create(i("repos/"+e+"/"+t+"/")),n}},{key:"reportError",value:function(e){console.log(e)}}]),e}();t.a=l},65:function(e,t,o){"use strict";function i(e){var t=e.slice(-1)[0],o=n.exec(t);return o?{x:o[1],y:o[2]}:{x:0,y:0}}var n=/<!-- ([.\d]+),([.\d]+) -->/;t.a={deserializeCommentToProject:function(e){var t=e.body.split("\r\n"),o=i(t);return{id:e.id,title:t[0],description:t[1],username:e.user.login,avatar_thumbnail:e.user.avatar_url+"&s=40",avatar:e.user.avatar_url+"&s=120",x:o.x,y:o.y,editMode:!1}},serializeProjectToComment:function(e){return e.title+"\r\n"+(e.description||"")+"\r\n\x3c!-- "+e.x+","+e.y+" --\x3e"}}},66:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(46),n=o(45),r=o.n(n);i.a.config.productionTip=!1,new i.a({el:"#app",template:"<App/>",components:{App:r.a}})},67:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(64),n=o(30),r=o(119),a=o.n(r),s=o(118),c=o.n(s),u=o(120),d=o.n(u),l=void 0;t.default={name:"app",data:function(){return{helpText:"",projects:[],mapWidth:0,mapHeight:0,form:{isOpen:!1,title:"",description:""},authenticationUrl:"",username:"",selectedProject:{id:"",avatar:"",username:"",editMode:"",title:"",description:""}}},methods:{toggleForm:function(){var e=this;return this.form.isOpen?(this.form.title=this.form.title.trim(),this.form.description=this.form.description.trim(),this.form.title||this.form.description?this.form.title?(l.postNewProject(this.form).then(function(t){e.projects.push(t),e.form.title="",e.form.description=""}).catch(function(e){return console.error(e)}),void(this.form.isOpen=!1)):void alert("Please enter a topic for your project"):void(this.form.isOpen=!1)):void(this.form.isOpen=!0)},leftDrag:function(e){var t=e.target.querySelector("img");e.dataTransfer.setDragImage(t,20,20);var o=e.target.dataset.id;e.dataTransfer.setData("projectId",o)},updateSelectedProject:function(e){this.selectedProject=e},centerDrop:function(e){var t=e.dataTransfer.getData("projectId"),o=this.projects.filter(function(e){return e.id===parseInt(t)})[0];this.updateMapDimensions();var i=o.x,n=o.y;o.x=e.offsetX/this.mapWidth,o.y=e.offsetY/this.mapHeight,l.updateProject(o).catch(function(e){console.log("update rejected",e),o.x=i,o.y=n})},updateMapDimensions:function(){var e=this.$el.querySelector(".floorplan");this.mapWidth=e.clientWidth,this.mapHeight=e.clientHeight},login:function(){l.ensureAuthenticatedClient().then(function(e){return console.log(e)})},logout:function(){this.username="",l.deauthenticateClient()},toggleEditMode:function(){this.selectedProject.editMode?(this.selectedProject.title=this.selectedProject.backup.title,this.selectedProject.description=this.selectedProject.backup.description):this.selectedProject.backup={title:this.selectedProject.title,description:this.selectedProject.description},this.selectedProject.editMode=!this.selectedProject.editMode},updateProject:function(){var e=this;l.updateProject(this.selectedProject).then(function(){e.selectedProject.editMode=!1}).catch(function(t){console.log("update rejected",t);var o=e.selectedProject.backup;e.selectedProject.title=o.title,e.selectedProject.description=o.description})}},components:{Left:a.a,Center:c.a,Right:d.a},mounted:function(){var e=this;l=new i.a({organization:"bkkhack",repository:"hackmap",label:"BKKHack Main Thread",onAuthenticationRequired:n.a.getOAuthToken,pollIntervalSeconds:60,onProjectsUpdated:function(t){e.projects=t},onHelpText:function(t){e.helpText=t},onUserAuthenticated:function(t){e.username=t.data.login}}),this.$el.querySelector(".floorplan").addEventListener("load",this.updateMapDimensions),this.updateMapDimensions(),window.addEventListener("resize",this.updateMapDimensions)}}},68:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"center",props:["helpText","username","projects","selectedProject","mapWidth","mapHeight"],methods:{dragover:function(e){this.$emit("dragover",e),e.preventDefault(),e.dataTransfer.dropEffect="copy"},drag:function(e){var t=e.target.dataset.id;e.dataTransfer.setData("projectId",t)},drop:function(e){this.$emit("drop",e)},login:function(){this.$emit("login")},logout:function(){this.$emit("logout")},updateSelectedProject:function(e){this.$emit("updateSelectedProject",e)}},beforeDestroy:function(){window.removeEventListener("resize",this.updateMapDimensions)}}},69:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"left",props:["form","projects","selectedProject","username"],methods:{toggleForm:function(){this.$emit("toggleForm")},drag:function(e){this.$emit("drag",e)},updateSelectedProject:function(e){this.$emit("updateSelectedProject",e)}}}},70:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"right",props:["selectedProject","username"],methods:{toggleEditMode:function(){this.$emit("toggleEditMode")},updateProject:function(){this.$emit("updateProject")}}}}},[66]);
//# sourceMappingURL=app.c3a494790757173f52cf.js.map